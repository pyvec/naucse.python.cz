
<!doctype html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>
            
                NI-PYT (Pokročilý Python): Requests – Weboví klienti
            
        </title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

        

        <link rel="stylesheet" href="/static/css/naucse.css">
        <link rel="stylesheet" href="/static/css/body.css">
        <link rel="stylesheet" href="/static/css/pygments-lovelace-style.css">
        <link rel="stylesheet" href="/static/css/ipython.css">

        
    <link rel="canonical" href="https://naucse.python.cz/lessons/intro/requests/" />


        <style>
            
    

        </style>
    </head>

    <body>
        <nav class="header">
            <ul class="container menu">
                <li><a href="/" class="logo"><h1>Nauč se Python!</h1></a></li>
                <li><a href="/courses/" class="menu-link"><h2>Materiály</h2></a></li>
                <li><a href="/runs/" class="menu-link"><h2>Kurzy</h2></a></li>
            </ul>
        </nav>

        

<div class="page">
    <div class="container">

        
            <header class="lesson-header">
                <a href="/">Nauč se Python </a>
                
                > <a href="/runs/">Kurzy</a>
                
                

> <a href="/2020/nipyt-zima/">NI-PYT (Pokročilý Python)</a>

> <a href="/2020/nipyt-zima/sessions/requests-click/">Weboví klienti &amp; CLI – Requests a Click</a>

> <a href="/2020/nipyt-zima/intro/requests/">Requests – Weboví klienti</a>


                <hr>
            </header>
        

        
  


        <div class="lesson-content">
          
    

    <h1>Requests</h1>
<p>Knihoven pro HTTP klienty (tedy “programy, které stahují webové stránky“)
je celá řada.
Jedna z nich, <a href="https://docs.python.org/3/library/urllib.request.html#module-urllib.request"><code>urllib.request</code></a>, je dokonce součástí standardní knihovny Pythonu.
Pokud tedy budete chtít HTTP používat a seznam závislostí
svého projektu nemůžete rozšířit o další knihovnu, jde to.</p>
<p>Mnohem snáze se vám ale bude pracovat s knihovnou <a href="https://requests.readthedocs.io/en/master/">Requests</a>,
která má mnohem “lidštější” rozhraní a používá se mnohem jednodušeji.
Rozdíl je největší u pokročilejších vlastností
jako <em>cookies</em>, autentizace nebo sdílení spojení (<em>Keep-alive</em>),
které s Requests zvládnete i bez detailních znalostí protokolu HTTP.</p>
<p>Dokonce i v dokumentaci modulu <code>urllib</code> se píše:
<em>The <a href="https://requests.readthedocs.io/en/master/">Requests package</a> is recommended for a higher-level HTTP
client interface.</em>
Zaměříme se tedy na Requests hned od začátku.</p>
<p>Knihovna Requests se instaluje standardním způsobem:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>python -m pip install requests
</pre></div><p>Budeme předpokládat, že znáte alespoň základy HTTP protokolu,
a vrhneme se rovnou na příklad.</p>
<div class="admonition note"><p>Pokud základy neznáte, můžete se podívat na
<a href="/2020/nipyt-zima/fast-track/http/">shrnutí pro začátečníky</a>,
které vysvětluje vše potřebné.</p>
</div><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">getpass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">username</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Username: '</span><span class="p">)</span>
<span class="go">Username: hroncok</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>
<span class="go">Password: </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://api.github.com/user'</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'content-type'</span><span class="p">]</span>
<span class="go">'application/json; charset=utf8'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">encoding</span>
<span class="go">'utf-8'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
<span class="go">'{"login":"hroncok"...'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{'avatar_url': 'https://avatars.githubusercontent.com/u/2401856?v=3', ...}</span>
</pre></div><div class="admonition note"><p>Tento příklad pracuje přímo se jménem a heslem.
To se většinou nedělá a webové API to často ani nepodporují.
Pokud na GitHub používáte dvoufaktorovou autentizaci, příklad nebude fungovat.</p>
</div><p>Příklady použití pro další HTTP metody najdete v <a href="http://docs.python-requests.org/en/master/user/quickstart/">dokumentaci</a>.</p>
<h2>Použití session</h2>
<p>Hlavně v budoucnu se nám bude hodit použití tzv.
<a href="http://docs.python-requests.org/en/master/user/advanced/#session-objects"><em>session</em></a>.</p>
<p>Session má několik výhod.
První je, že využívá na pozadí jedno otevřené HTTP spojení a poskytuje tak
při více sousledných požadavcích výrazné zrychlení.</p>
<p>Dále pak session automaticky ukládá <em>cookies</em> a je možné u ní nastavit výchozí
hlavičky.</p>
<p>Zkuste si <em>cookies</em> vyzkoušet s <a href="http://httpbin.org">httpbin.org</a> – službou
k testování HTTP dotazů:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://httpbin.org/cookies/set/mipyt/best'</span><span class="p">)</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://httpbin.org/cookies'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{'cookies': {'mipyt': 'best'}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'x-test'</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://httpbin.org/headers'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">'x-test2'</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="go">{'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Cookie': 'mipyt=best', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.19.1', 'X-Test': 'true', 'X-Test2': 'true'}}</span>
</pre></div><h2>GitHub API</h2>
<p>Podíváme se teď, podobně jako v úvodním příkladu, na <a href="https://developer.github.com/v3">GitHub API</a>,
které má poměrně jednoduchou autentizaci (od GitHubu přímo
získáte token). Stačí jít do <a href="https://github.com/settings/tokens">nastavení</a> a vyrobit nový token
(zatím není třeba zaškrtávat žádná oprávnění).</p>
<div class="admonition warning"><p class="admonition-title">Ochrana přihlašovacích tokenů</p>
<p>Váš token je něco jako vaše heslo.
Nikomu je nesmíte ukazovat a nesmíte jej dát do Gitu.
Stane-li se přesto, že se k němu dostane někdo nepovolaný,
můžete jej v <a href="https://github.com/settings/tokens">nastavení</a> opět smazat.</p>
</div><p>Pomocí tokenu můžete z GitHubu získávat informace.
Prozatím token nastavte do proměnné, později jej schováme například do
konfiguračního souboru.</p>
<p>Tímto kódem lze například získat popis přihlášeného uživatele, tedy sebe sama.</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">token</span> <span class="o">=</span> <span class="s1">'d7313dab254b7fd0d0f3ec3cbf754b3abce462d5'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'User-Agent'</span><span class="p">:</span> <span class="s1">'Python'</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">token_auth</span><span class="p">(</span><span class="n">req</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s1">'</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">req</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="n">token_auth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://api.github.com/user'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div><p>Funkce <code>session.auth</code> v příkladu výše je autentizační funkce,
která nějakým způsobem modifikuje HTTP požadavek za účelem autentizace,
většinou přidává specifické hlavičky (jak je tomu i zde).
Lze ji nastavit buďto na celé session nebo předat argumentem <code>auth</code> s každým
požadavkem.</p>
<p>Existují předpřipravené funkce v modulu <code>requests.auth</code>, například 
<code>requests.auth.HTTPBasicAuth</code> provádí základní HTTP přihlášení.
Dle specifikace zakóduje jméno a heslo pomocí
algoritmu base64 a přidá hlavičku <code>Authorization</code>.</p>
<p><a href="https://cs.wikipedia.org/wiki/Basic_access_authentication">Základní HTTP přihlášení</a>
je tak běžné, že pro něj Requests mají zkratku –
místo <code>HTTPBasicAuth</code> se dá použít i dvojice (jméno, heslo):</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://httpbin.org/basic-auth/AzureDiamond/hunter2'</span><span class="p">,</span>
<span class="go">                 auth=requests.auth.HTTPBasicAuth('AzureDiamond', 'hunter2'))</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://httpbin.org/basic-auth/AzureDiamond/hunter2'</span><span class="p">,</span>
<span class="go">                 auth=('AzureDiamond', 'hunter2'))</span>
</pre></div><div class="admonition note"><p>Všimněte si také hlavičky <code>User-Agent</code>.
Ta je potřeba při komunikaci s GitHub API explicitně nastavit.
Nastavení na objektu session zajistí, že tato hlavička
bude ve všech požadavcích.</p>
</div><p>Pokud budete chtít něco provést, například dát hvězdičku repozitáři s těmito
materiály, musíte tokenu nastavit patřičné oprávnění
(u hvězdičky je to <code>public_repo</code>).
To se dělá přes <a href="https://github.com/settings/tokens">nastavení</a> na GitHubu.</p>
<p>Hvězdičku pak přidáte takto:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'https://api.github.com/user/starred/pyvec/naucse.python.cz'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
<span class="go">''</span>
</pre></div><p>Jak vidíte, API nevrací žádný text (žádné tělo odpovědi).
Můžete ale zkontrolovat návratový stav:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">204</span>
</pre></div><p>Případně vyhodit výjimku, pokud je stavový kód divný (např <em>404 Nenalezeno</em>,
<em>401 Chybí oprávnění</em> apod.):</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</pre></div><p>Pokud hvězdičku chcete odebrat, použijte metodu DELETE.
My ale věříme, že ji odebrat nechcete :)</p>
<p><a href="https://developer.github.com/v3/">Dokumentace</a> ke GitHub API.</p>
<h2>Chraňte své tokeny</h2>
<p>Když ukládáte skript do gitu, mějte na paměti, že tokeny a klíče do něj nikdy
nepatří. Můžete je uložit do konfiguračního souboru, který bude gitem ignorován,
například takhle:</p>
<div class="highlight"><pre><span></span><span class="k">[github]</span>
<span class="na">token</span> <span class="o">=</span> <span class="s">d7313dab254b7fd0d0f3ec3cbf754b3abce462d5</span>
</pre></div><p>A následně konfiguraci načtete pomocí modulu
<a href="https://docs.python.org/3/library/configparser.html">configparser</a>:</p>
<div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'auth.cfg'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">config</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="p">[</span><span class="s1">'github'</span><span class="p">][</span><span class="s1">'token'</span><span class="p">]</span>
<span class="go">'d7313dab254b7fd0d0f3ec3cbf754b3abce462d5'</span>
</pre></div><p>Do souboru <code>.gitignore</code> pak musíte přidat název ignorovaného souboru, např.:</p>
<div class="highlight"><pre><code>auth.cfg

</code></pre></div><p>Ověřte si, že git soubor <code>auth.cfg</code> opravdu ignoruje, t.j. soubor se neukáže
ve výstupu <code>git status</code>.</p>
<p>Jelikož ostatní tento konfigurační soubor neuvidí,
je vhodné jim vysvětlit, jak takový soubor (s jejich údaji) vytvořit.
Můžete například vložit do gitu soubor <code>auth.cfg.sample</code>
s vymyšlenými údaji, či příklad uvést v README.</p>
<div class="admonition note"><p>ConfigParser změní velikost písmen klíčů z konfiguračního souboru na malá.
Pokud potřebujete, aby byly klíče přesně tak, jak jsou v souboru, musíte
před načtením nastavit <code>config.optionxform = str</code>.</p>
</div>


        </div>

        
        <hr class="lesson-end">

        
            <div class="alert alert-info">
                Toto je stránka lekce z kurzu, který probíhá nebo proběhl naživo s instruktorem.
                
                    
                        <a href="https://naucse.python.cz/lessons/intro/requests/">Přejít na stejnou lekci v kurzu pro samouky</a>.
                    
                
            </div>
        


        
    <div class="row prev-next">
        
            
                
    <div class="col text-left">
        <a href="/2020/nipyt-zima/fast-track/install/">← <span class="d-none d-sm-inline">Vytvoření virtuáního prostředí</span></a>
    </div>

            
            
                
    <div class="col text-left">
        <a href="/2020/nipyt-zima/sessions/requests-click/">↑ <span class="d-none d-sm-inline">Lekce: Weboví klienti &amp; CLI – Requests a Click</span></a>
    </div>

            
            
                
    <div class="col text-right">
        <a href="/2020/nipyt-zima/intro/click/"><span class="d-none d-sm-inline">Click – Rozhraní pro příkazovou řádku</span> →</a>
    </div>

            
        
    </div>


        

    </div>
</div>



        <script type="text/javascript" src="/static/js/solutions.js"></script>

        <div class="footer container">
            <hr>
            <div class="lesson-attribution">
                
                    <p>
                        Uprav tuto stránku na
                        <a href="https://github.com/cvut/naucse.python.cz/blob/b201/lessons/intro/requests/index.md">
                            
                                <svg class="icon icon-github" viewBox="0 0 64 64">
<path d="M32 0 C14 0 0 14 0 32 0 53 19 62 22 62 24 62 24 61 24 60 L24 55 C17 57 14 53 13 50 13 50 13 49 11 47 10 46 6 44 10 44 13 44 15 48 15 48 18 52 22 51 24 50 24 48 26 46 26 46 18 45 12 42 12 31 12 27 13 24 15 22 15 22 13 18 15 13 15 13 20 13 24 17 27 15 37 15 40 17 44 13 49 13 49 13 51 20 49 22 49 22 51 24 52 27 52 31 52 42 45 45 38 46 39 47 40 49 40 52 L40 60 C40 61 40 62 42 62 45 62 64 53 64 32 64 14 50 0 32 0 Z" fill="currentColor" stroke-width="0"/>
</svg>
                            
                          GitHubu
                        </a>
                    </p>
                

                
    
        <p>Pro kurz MI-PYT na ČVUT napsali Miro Hrončok, Petr Viktorin a další, 2016-2017.</p>
    

                
    <p>
        Licence:
        <a href="https://creativecommons.org/licenses/by-sa/4.0/">
            Creative Commons Attribution-ShareAlike 4.0 International
        </a>
    </p>
    
        <p>
            Licence ukázek kódu:
            <a href="https://creativecommons.org/publicdomain/zero/1.0/">
                CC0 1.0 Universal Public Domain Dedication
            </a>
        </p>
    

                
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

        

    </body>
</html>