
<!doctype html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>
            
                Linuxová administrace: Další kombinace příkazů
            
        </title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

        

        <link rel="stylesheet" href="/static/css/naucse.css">
        <link rel="stylesheet" href="/static/css/body.css">
        <link rel="stylesheet" href="/static/css/pygments-lovelace-style.css">
        <link rel="stylesheet" href="/static/css/ipython.css">

        
    


        <style>
            
    

        </style>
    </head>

    <body>
        <nav class="header">
            <ul class="container menu">
                <li><a href="/" class="logo"><h1>Nauč se Python!</h1></a></li>
                <li><a href="/courses/" class="menu-link"><h2>Materiály</h2></a></li>
                <li><a href="/runs/" class="menu-link"><h2>Kurzy</h2></a></li>
            </ul>
        </nav>

        

<div class="page">
    <div class="container">

        
            <header class="lesson-header">
                <a href="/">Nauč se Python </a>
                
                > <a href="/runs/">Kurzy</a>
                
                

> <a href="/2021/linuxadmin-podzim/">Linuxová administrace</a>

> <a href="/2021/linuxadmin-podzim/sessions/descriptors/">Bash III</a>

> <a href="/2021/linuxadmin-podzim/linuxadmin/and-or-background/">Další kombinace příkazů</a>


                <hr>
            </header>
        

        
  


        <div class="lesson-content">
          
    

    <h1>Další kombinace příkazů</h1>
<p>Už víš, že pomocí „roury“ (<code>|</code>) se dá poslat výstup z jednoho příkazu
do druhého.
Existuje ale několik dalších příkazů, kterými se v Bashi dají příkazy
kombinovat.</p>
<p>Nejjednodušší je středník (<code>;</code>): Bash napřed provede příkaz na levé straně,
počká až se dokončí, a potom spustí ten na pravé.</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="s1">'Vysledek je'</span><span class="p">;</span> python -c <span class="s1">'print(1 + 1)'</span>
<span class="go">Vysledek je</span>
<span class="go">2</span>
</pre></div><p>Docela užitečný operátor je <code>&amp;&amp;</code> (logické A; angl. <em>AND</em>): napřed se provede
příkaz na levé straně a počká se na výsledek.
Příkaz na pravé straně se provede pouze pokud první příkaz uspěl.
To že příkaz „uspěl“ znamená, že vrátil návratovou hodnotu 0.</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>python -c <span class="s1">'print(1 + )'</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">'je výsledek'</span>
<span class="go">  File "&lt;string&gt;", line 1</span>
<span class="go">    print(1 + )</span>
<span class="go">              ^</span>
<span class="go">SyntaxError: invalid syntax</span>
</pre></div><p>Tenhle operátor se hodí např. v případech, kdy píšeš program který připraví
nějaký soubor. Příkaz <code>python priprav-soubor.py &amp;&amp; head pripraveny-soubor.dat</code>
vypíše ukázku výsledku, ale jen když se všechno povedlo.
Když Python skončí s chybou, může existovat stará verze <code>pripraveny-soubor.dat</code>
z minulého spuštění.
Ale nevypíše se a na obrazovce zůstane chybová hláška od Pythonu.</p>
<p>Opak je <code>||</code> (logické NEBO; angl. <em>OR</em>): příkaz na pravé straně se provede,
pokud příkaz nalevo <em>neuspěl</em> (<code>$?</code> není 0).</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>python -c <span class="s1">'print(1 + )'</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'Jejda! Chyba!'</span>
<span class="go">  File "&lt;string&gt;", line 1</span>
<span class="go">    print(1 + )</span>
<span class="go">              ^</span>
<span class="go">SyntaxError: invalid syntax</span>
<span class="go">Jejda! Chyba!</span>
</pre></div><h2>Spouštění na pozadí</h2>
<p>A nakonec, když dáš za příkaz <code>&amp;</code>, tak Bash nebude čekat na konec programu,
ale pokračuje hned dál.
Když program skončí, dá Bash před dalším promptem vědět.</p>
<p>Hezky se to zkouší na příkazu <code>sleep</code>, který čeká daný počet vteřin:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>sleep <span class="m">1</span>
<span class="gp">$ </span>sleep <span class="m">1</span> <span class="p">&amp;</span>
<span class="go">[1] 25507</span>
<span class="gp">$
</span><span class="gp">$ </span><span class="c1"># vteřinu počkej...</span>
<span class="go">[1]+  Dokončena              sleep 1</span>
<span class="gp">$
</span></pre></div><p>Pozor na to, že program „v pozadí“ sdílí s Bashem terminál,
takže pokud bude něco psát na std. výstupů, bude se s Bashem „hádat“.</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>curl https://httpbin.org/get <span class="p">&amp;</span>
<span class="go">[1] 25537</span>
<span class="gp">$ </span><span class="o">{</span> ... sem curl vypíše jakási stažená JSON data ...  <span class="o">}</span>
</pre></div><p>Programy běžící na pozadí můžeš vypsat pomocí <code>jobs</code>.
U každého vypíše malé číslo, pomocí kterého se taková „úloha“ (angl. <em>job</em>)
dá ovládat:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>sleep <span class="m">200</span> <span class="p">&amp;</span>
<span class="go">[1] 34696</span>
<span class="gp">$ </span>sleep <span class="m">300</span> <span class="p">&amp;</span>
<span class="go">[2] 34701</span>
<span class="gp">$ </span>sleep <span class="m">400</span> <span class="p">&amp;</span>
<span class="go">[3] 34706</span>
<span class="gp">$ </span><span class="nb">jobs</span>
<span class="go">[1]   Běží                 sleep 20 &amp;</span>
<span class="go">[2]-  Běží                 sleep 30 &amp;</span>
<span class="go">[3]+  Běží                 sleep 40 &amp;</span>
</pre></div><p>Úloha nemusí být vždy jen jednotlivý proces:</p>
<div class="highlight"><pre><code>$ sleep 500 &amp;&amp; sleep 600 &amp;
[4] 34846
$ jobs
[1]   Běží                 sleep 20 &amp;
[2]   Běží                 sleep 30 &amp;
[3]-  Běží                 sleep 40 &amp;
[4]+  Běží                 sleep 4 &amp;&amp; sleep 5 &amp;</code></pre></div><p>Úlohu který běží na pozadí lze popředí pomocí příkazu <code>fg</code>
(z angl. <em>foreground</em>, popředí);
kterému předáš číslo úlohy za procentem (<code>%</code>):</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">fg</span> %1
<span class="go">sleep 200</span>
</pre></div><p>Úlohu běžící na popředí – tu, na kterou Bash právě čeká – můžeš
zastavit pomocí <kbd>Ctrl</kbd>+<kbd>Z</kbd>:</p>
<div class="highlight"><pre><span></span><span class="go">^Z</span>
<span class="go">[1]+  Pozastavena             sleep 200</span>
<span class="gp">$ </span><span class="nb">jobs</span>
<span class="go">[1]+  Pozastavena             sleep 200</span>
<span class="go">[2]   Běží                 sleep 300 &amp;</span>
<span class="go">[3]   Běží                 sleep 400 &amp;</span>
<span class="go">[4]-  Běží                 sleep 500 &amp;&amp; sleep 600 &amp;</span>
</pre></div><p>Pozastavená úloha neběží.
Můžeš ji ale odpauzovat buď příkazem <code>fg</code>, který ji dá na popředí (tj. Bash
bude čekat než se ukončí).
Nebo ji můžeš spustit na pozadí příkazem <code>bg</code> (z angl. <em>background</em>, pozadí),
Po tom bude úloha ve stejném stavu jako kdybys ji spustila s <code>&amp;</code>.</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">bg</span> %1
<span class="go">[1]+ sleep 200 &amp;</span>
<span class="gp">$ </span><span class="nb">jobs</span>
<span class="go">[1]+  Běží                 sleep 200</span>
<span class="go">[2]   Běží                 sleep 300 &amp;</span>
<span class="go">[3]   Běží                 sleep 400 &amp;</span>
<span class="go">[4]-  Běží                 sleep 500 &amp;&amp; sleep 600 &amp;</span>
</pre></div><p>Argumentům s procentem rozumí i příkaz <code>kill</code>, který danou úlohu ukončí:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">kill</span> %4
<span class="go">[4]+  Ukončen (SIGTERM)      sleep 500 &amp;&amp; sleep 600</span>
</pre></div><p>Když zadáš příkazu <code>fg</code> nebo <code>bg</code> bez argumentu, vybere „poslední“ úlohu.
Ta je ve výstupu <code>jobs</code> označena plusem.</p>
<p>Existují i další zkratky, např.:</p>
<ul>
<li><code>%+</code> a <code>%%</code> vyberou „poslední“ úlohu – tu označenou plusem.</li>
<li><code>%-</code> vybere a „předposlední“ úlohu – tu označenou minusem.</li>
<li><code>%abcd</code> vybere úlohu spuštěnou příkazem začínajícím na <code>abcd</code> (pokud
je spuštěna  právě jedna taková úloha).</li>
</ul>


        </div>

        
        <hr class="lesson-end">

        
            <div class="alert alert-info">
                Toto je stránka lekce z kurzu, který probíhá nebo proběhl naživo s instruktorem.
                
            </div>
        


        
    <div class="row prev-next">
        
            
                
    <div class="col text-left">
        <a href="/2021/linuxadmin-podzim/linuxadmin/fork-exec/">← <span class="d-none d-sm-inline">Bonus: Fork a exec</span></a>
    </div>

            
            
                
    <div class="col text-left">
        <a href="/2021/linuxadmin-podzim/sessions/descriptors/">↑ <span class="d-none d-sm-inline">Lekce: Bash III</span></a>
    </div>

            
            
                
    <div class="col text-right">
        <a href="/2021/linuxadmin-podzim/linuxadmin/bin-func-alias/"><span class="d-none d-sm-inline">Programy, funkce a aliasy</span> →</a>
    </div>

            
        
    </div>


        

    </div>
</div>



        <script type="text/javascript" src="/static/js/solutions.js"></script>

        <div class="footer container">
            <hr>
            <div class="lesson-attribution">
                
                    <p>
                        Uprav tuto stránku na
                        <a href="https://github.com/encukou/linuxadmin/blob/main/lessons/linuxadmin/and-or-background/index.md">
                            
                                <svg class="icon icon-github" viewBox="0 0 64 64">
<path d="M32 0 C14 0 0 14 0 32 0 53 19 62 22 62 24 62 24 61 24 60 L24 55 C17 57 14 53 13 50 13 50 13 49 11 47 10 46 6 44 10 44 13 44 15 48 15 48 18 52 22 51 24 50 24 48 26 46 26 46 18 45 12 42 12 31 12 27 13 24 15 22 15 22 13 18 15 13 15 13 20 13 24 17 27 15 37 15 40 17 44 13 49 13 49 13 51 20 49 22 49 22 51 24 52 27 52 31 52 42 45 45 38 46 39 47 40 49 40 52 L40 60 C40 61 40 62 42 62 45 62 64 53 64 32 64 14 50 0 32 0 Z" fill="currentColor" stroke-width="0"/>
</svg>
                            
                          GitHubu
                        </a>
                    </p>
                

                
    
        <p>napsali Karolina Surma a Petr Viktorin, 2020-2021</p>
    

                
    <p>
        Licence:
        <a href="https://creativecommons.org/licenses/by-sa/4.0/">
            Creative Commons Attribution-ShareAlike 4.0 International
        </a>
    </p>
    

                
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

        

    </body>
</html>